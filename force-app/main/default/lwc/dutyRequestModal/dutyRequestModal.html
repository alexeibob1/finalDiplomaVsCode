<template>
    <lightning-modal-header label="Выбор смен и дат"></lightning-modal-header>

    <lightning-modal-body>
        <template if:true={isLoading}>
            <div class="slds-align_absolute-center">
                <lightning-spinner alternative-text="Загрузка..." size="medium"></lightning-spinner>
            </div>
        </template>

        <template if:false={isLoading}>
            <div class="slds-text-body_regular">
                <p>Выберите до 5 смен в течение месяца.</p>
                
                <!-- Show warning if user already has 5 requests -->
                <template if:true={showRequestLimitWarning}>
                    <div class="slds-text-color_warning">
                        <p>У вас уже есть 5 заявок на этот месяц. Вы не можете добавить больше заявок.</p>
                    </div>
                </template>

                <div class="table-scroll">
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <template for:each={shifts} for:item="shift">
                                    <th key={shift.Id}>{shift.Duty_Shift__r.Name}</th>
                                </template>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={calendarData} for:item="row">
                                <tr key={row.key}>
                                    <td>{row.date}</td>
                                    <td>
                                        <lightning-input type="checkbox"
                                                         checked={row.checked}
                                                         data-date={row.date}
                                                         data-shift-id={row.shiftId}
                                                         onchange={handleCheckboxChange}
                                                         disabled={row.disabled}>
                                        </lightning-input>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </template>
    </lightning-modal-body>

    <lightning-modal-footer>
        <lightning-button label="Отмена" onclick={handleCancel}></lightning-button>
        <lightning-button variant="brand" label="Отправить" onclick={handleSubmit} class="slds-m-left_small"></lightning-button>
    </lightning-modal-footer>
</template>
